\hypertarget{_c_t_wi_fi_8h_source}{}\doxysection{CTWi\+Fi.\+h}
\mbox{\hyperlink{_c_t_wi_fi_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <WiFi.h>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <Ticker.h>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_c_t_wi_fi_8h_a26d672abfebc2e411431d712c7a3a2a5}{ap\_launched}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00016\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_c_t_wi_fi_8h_a06e6d1fdb84edff554b1c4722c9a774a}{launch\_access\_point}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ssid,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ password)\ \{}
\DoxyCodeLine{00017\ \ \ WiFi.softAPdisconnect(\textcolor{keyword}{true});}
\DoxyCodeLine{00018\ \ \ WiFi.softAP(ssid,\ password);}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_a26d672abfebc2e411431d712c7a3a2a5}{ap\_launched}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \textcolor{comment}{//\ update\_device\_config(ssid,\ password);}}
\DoxyCodeLine{00023\ \ \ }
\DoxyCodeLine{00024\ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}-\/WIFI\ AP\ :\ Access\ Point\ Démarré"{}});}
\DoxyCodeLine{00025\ \ \ \mbox{\hyperlink{_c_t_debug_8h_a4eca408d5b2f9358eb72ba9f1b004589}{MYDEBUG\_PRINTF}}(\textcolor{stringliteral}{"{}-\/WIFI\ AP\ :\ Connectez-\/vous\ à\ \%s\ et\ ouvrez\ \%s\ dans\ un\ navigateur\ web\(\backslash\)n"{}},\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_a8dfd96f6f709ce443636ca56e0cfadcf}{device\_name}}.c\_str(),\ WiFi.softAPIP().toString().c\_str());}
\DoxyCodeLine{00026\ \ \ \textcolor{keywordflow}{if}\ (\ WiFi.status()\ ==\ WL\_CONNECTED\ )\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_a4eca408d5b2f9358eb72ba9f1b004589}{MYDEBUG\_PRINTF}}(\textcolor{stringliteral}{"{}-\/WIFI\ AP\ :\ ou\ connectez-\/vous\ à\ \%s\ et\ ouvrez\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad26538ba868015b0ad8e7063d725ac10}{net\_ssid}}.c\_str(),\ WiFi.localIP().toString().c\_str());}
\DoxyCodeLine{00028\ \ \ \}}
\DoxyCodeLine{00029\ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00042\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_c_t_wi_fi_8h_aba7acb281ac9938c1d6ea74cb0ff28b7}{check\_AP\_state}}()\ \{}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_c_t_wi_fi_8h_a26d672abfebc2e411431d712c7a3a2a5}{ap\_launched}})\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00045\ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ get\_config();}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_a06e6d1fdb84edff554b1c4722c9a774a}{launch\_access\_point}}(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_a8dfd96f6f709ce443636ca56e0cfadcf}{device\_name}}.c\_str(),\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad8b7cc350ecbeeb4996d0e2151d9ecd7}{device\_password}}.c\_str());}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_c_t_wi_fi_8h_a6e1ad9bcb459e5f63213d33e746137d2}{connect\_WiFi\_network}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ssid,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ password,\ uint\ cycles\ =\ 50)\ \{}
\DoxyCodeLine{00068\ \ \ WiFi.disconnect(\textcolor{keyword}{true});}
\DoxyCodeLine{00069\ \ \ WiFi.begin(ssid,\ password);}
\DoxyCodeLine{00070\ \ \ }
\DoxyCodeLine{00071\ \ \ \mbox{\hyperlink{_c_t_debug_8h_a6551348c963ff72de879c179ce1f1a86}{MYDEBUG\_PRINT}}(\textcolor{stringliteral}{"{}-\/WIFI\ :\ Connexion\ au\ réseau\ :\ "{}});}
\DoxyCodeLine{00072\ \ \ \mbox{\hyperlink{_c_t_debug_8h_a6551348c963ff72de879c179ce1f1a86}{MYDEBUG\_PRINT}}(ssid);}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ cycles;\ i++)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{if}\ (WiFi.status()\ ==\ WL\_CONNECTED)\ \{}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_a6551348c963ff72de879c179ce1f1a86}{MYDEBUG\_PRINT}}(\textcolor{stringliteral}{"{}\(\backslash\)n-\/WIFI\ :\ Réussite,\ connecté\ à\ "{}});}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(ssid);}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \ \ \textcolor{comment}{//\ update\_network\_config(ssid,\ password);}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_aba7acb281ac9938c1d6ea74cb0ff28b7}{check\_AP\_state}}();}
\DoxyCodeLine{00082\ \ \ \ \ \ \ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00084\ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_a6551348c963ff72de879c179ce1f1a86}{MYDEBUG\_PRINT}}(\textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{00086\ \ \ \ \ delay(100);}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}\(\backslash\)n-\/WIFI\ :\ Connexion\ échouée"{}});}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00100\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_c_t_wi_fi_8h_a4e5b01da019ba4bd3017834f0a6bb112}{check\_WiFi\_connection}}()\ \{}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordflow}{if}\ (WiFi.status()\ ==\ WL\_CONNECTED)\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00103\ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ get\_config();}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_c_t_wi_fi_8h_a6e1ad9bcb459e5f63213d33e746137d2}{connect\_WiFi\_network}}(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad26538ba868015b0ad8e7063d725ac10}{net\_ssid}}.c\_str(),\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_af6ef0046248df12325414b15f6563307}{net\_password}}.c\_str());}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_c_t_wi_fi_8h_a9375bbc4ef4686014ba29a6976043914}{try\_WiFi\_connect}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ssid,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ password)\ \{}
\DoxyCodeLine{00124\ \ \ }
\DoxyCodeLine{00125\ \ \ \textcolor{keywordtype}{bool}\ connectionSuccess\ =\ \mbox{\hyperlink{_c_t_wi_fi_8h_a6e1ad9bcb459e5f63213d33e746137d2}{connect\_WiFi\_network}}(ssid,\ password,\ 20);}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (\ !connectionSuccess\ )\ \{}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_a6551348c963ff72de879c179ce1f1a86}{MYDEBUG\_PRINT}}(\textcolor{stringliteral}{"{}-\/WIFI\ :\ connecté\ à\ "{}});}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad26538ba868015b0ad8e7063d725ac10}{net\_ssid}});}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ WiFi.disconnect(\textcolor{keyword}{true});}
\DoxyCodeLine{00133\ \ \ \ \ WiFi.begin(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad26538ba868015b0ad8e7063d725ac10}{net\_ssid}},\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_af6ef0046248df12325414b15f6563307}{net\_password}});}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ \ \ }
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_c_t_wi_fi_8h_aab0860be730eccbf7b6ffee4b3f1ccde}{WiFiTicker}}()\ \{}
\DoxyCodeLine{00142\ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_a4e5b01da019ba4bd3017834f0a6bb112}{check\_WiFi\_connection}}();}
\DoxyCodeLine{00143\ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00150\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_c_t_wi_fi_8h_ad2a97dbe5f144cd247e3b15c6af7c767}{setupWiFi}}()\ \{}
\DoxyCodeLine{00151\ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}-\/WIFI\ :\ Configuration\ "{}});}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \textcolor{comment}{//\ Configuration\ de\ la\ carte\ en\ mode\ Access\ Point\ ET\ Station}}
\DoxyCodeLine{00154\ \ \ WiFi.mode(WIFI\_AP\_STA);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ launch\_access\_point(device\_name.c\_str(),\ device\_password.c\_str());}}
\DoxyCodeLine{00157\ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_a6e1ad9bcb459e5f63213d33e746137d2}{connect\_WiFi\_network}}(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad26538ba868015b0ad8e7063d725ac10}{net\_ssid}}.c\_str(),\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_af6ef0046248df12325414b15f6563307}{net\_password}}.c\_str());}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \mbox{\hyperlink{_c_t_events_8h_a3d5d2a1946d191159f8b0464f1433d49}{AddNetworkCredentialsChangedCallback}}([](\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ssid,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ password)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}-\/WIFI\ NET\ :\ Nouveaux\ identifiants\ de\ connexion\ reçus"{}});}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_a9375bbc4ef4686014ba29a6976043914}{try\_WiFi\_connect}}(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad26538ba868015b0ad8e7063d725ac10}{net\_ssid}}.c\_str(),\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_af6ef0046248df12325414b15f6563307}{net\_password}}.c\_str());}
\DoxyCodeLine{00162\ \ \ \});}
\DoxyCodeLine{00163\ \ \ \mbox{\hyperlink{_c_t_events_8h_a22604d8f8e901fe1b2464e9fa2ac0641}{AddDeviceCredentialsChangedCallback}}([](\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ssid,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ password)\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \mbox{\hyperlink{_c_t_debug_8h_ad1163597277388424d1b42c909a1be64}{MYDEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}-\/WIFI\ AP\ :\ Nouveaux\ identifiants\ reçus"{}});}
\DoxyCodeLine{00165\ \ \ \ \ \mbox{\hyperlink{_c_t_wi_fi_8h_a06e6d1fdb84edff554b1c4722c9a774a}{launch\_access\_point}}(\mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_a8dfd96f6f709ce443636ca56e0cfadcf}{device\_name}}.c\_str(),\ \mbox{\hyperlink{_c_t_s_p_i_f_f_s_8h_ad8b7cc350ecbeeb4996d0e2151d9ecd7}{device\_password}}.c\_str());}
\DoxyCodeLine{00166\ \ \ \});}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \mbox{\hyperlink{_c_t_ticker_8h_afb3489134709c30e0c4aeaa50f03a2e8}{myTicker}}.attach(20,\ \mbox{\hyperlink{_c_t_wi_fi_8h_aab0860be730eccbf7b6ffee4b3f1ccde}{WiFiTicker}});}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \}}

\end{DoxyCode}
